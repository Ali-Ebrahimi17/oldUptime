<% layout('layouts/boilerplateTCard')%>


<div class="main-tCard-container">
  <h2 class="main-title"><%= division.toUpperCase()  %> CRITICAL CHECKS</h2>
  <div class="row" style="width: 100%;">
    <div  id="reallocation-container" >


            <div class="modal-form" style="width: 1150px; margin-top: -50px;" >
                <div class="modal-content" style="border-radius: 0;">
                  <div style="background-color: rgb(252, 176, 38); height: 50px;">
                      <button  style="color: black; margin: 5px;" class="close"  aria-label="Close"></button>
                     <h4 style="text-align: center; margin: 8px;"><%= tCard.name.toUpperCase() %></h4>
                  </div>
                  <div class="modal-body">
                      <form action="/tCard/<%= tCard._id %>/check/contain" method="POST" >
                          <fieldset>
                            <div class="form-group">
                                <label for="exampleTextarea">Pass Requirements</label>
                                <textarea class="form-control" id="reasonTextarea" rows="3" style="resize: none" disabled><%= tCard.description %></textarea>
                              </div>
                              <% if (tCard.type === 'Value') { %>
                                <div class="row">
                                  <div class="col">
                                    <label for="exampleTextarea">Checked Failed By</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.checkedBy  %> - <%= moment(tCard.failedAt).format("DD/MM/YYYY - HH:mm:ss") %></textarea>
                                  </div>
                                </div>
                                <div class="row">
                                  <div class="col">
                                    <label for="exampleTextarea">Check Value</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none" disabled><%= tCard.value  %><%= tCard.unit  %></textarea>
                                  </div>
                                  <div class="col">
                                    <label for="exampleTextarea">Reason For Failure</label>
                                    <textarea class="form-control" name="check[reason]" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.reason %></textarea>
                                  </div>
                                </div>

                                <% if (tCard.action && tCard.action.includes('aintenance')) { %>
                                  <div class="form-group">
                                    <label for="exampleTextarea">Action Taken</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;"  disabled><%= tCard.action %> - <%= tCard.maintenancePerson %></textarea>
                                </div>
                                <div class='row'>
                                  <div class='col'>
                                    <form action="/tCard/<%= tCard._id %>/check/contain" method="POST">
                                      <div class="form-group">
                                        <label for="exampleTextarea">Update Maintenance Notes</label>
                                        <textarea class="form-control" id="reasonTextarea" rows="6" style="resize: none; margin-bottom: 15px;" name="check[maintenanceNotes]"><%= tCard.maintenanceNotes %></textarea>
                                    </div>
                                    <button class="btn btn-info">Update Notes</button>
                                    </form>

                                  </div>
                                  <div class='col'>
                                    <label for="exampleTextarea">Maintenance Notes</label>
                                      <div class="form-group update-history" >
                                        <ul>
                                          <% for (let note of tCard.notes) { %>
                                            <li><em><%= moment(note.createdAt).format("DD/MM/YYYY - HH:mm") %></em><br><%=  note.maintenanceNotes %></li>
                                            <hr style="width: 90%;">
                                          <% } %>
                                        </ul>
                                    </div>

                                  </div>

                                </div>
                                <% } else { %>
                                  <div class="form-group">
                                    <label for="exampleTextarea">Action Taken</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.action %></textarea>
                                </div>
                               <% } %>
                              <% } %>
                              <% if (tCard.type !== 'Value' ) { %>
                                <div class="row">
                                  <div class="col">
                                    <label for="exampleTextarea">Checked Failed By</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.checkedBy  %> - <%= moment(tCard.failedAt).format("DD/MM/YYYY - HH:mm:ss") %></textarea>
                                  </div>
                                  <div class="col">
                                    <label for="exampleTextarea">Check Outcome</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.agreed  %></textarea>
                                  </div>
                                  <div class="col">
                                    <label for="exampleTextarea">Reason For Failure</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.reason %></textarea>
                                  </div>
                                </div>

                                <% if (tCard.action && tCard.action.includes('aintenance')) { %>
                                  <div class="form-group">
                                    <label for="exampleTextarea">Action Taken</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;"  disabled><%= tCard.action %> - <%= tCard.maintenancePerson %></textarea>
                                </div>
                                <div class='row'>
                                  <div class='col'>
                                    <form action="/tCard/<%= tCard._id %>/check/contain" method="POST">
                                      <div class="form-group">
                                        <label for="exampleTextarea">Update Maintenance Notes</label>
                                        <textarea class="form-control" id="reasonTextarea" rows="6" style="resize: none; margin-bottom: 15px;" name="check[maintenanceNotes]"><%= tCard.maintenanceNotes %></textarea>
                                    </div>
                                    <button class="btn btn-info">Update Notes</button>
                                    </form>

                                  </div>
                                  <div class='col'>
                                    <label for="exampleTextarea">Maintenance Notes</label>
                                      <div class="form-group update-history" >
                                        <ul>
                                          <% for (let note of tCard.notes) { %>
                                            <li><em><%= moment(note.createdAt).format("DD/MM/YYYY - HH:mm") %></em><br><%=  note.maintenanceNotes %></li>
                                            <hr style="width: 90%;">
                                          <% } %>
                                        </ul>
                                    </div>

                                  </div>

                                </div>
                                <% } else { %>
                                  <div class="form-group">
                                    <label for="exampleTextarea">Action Taken</label>
                                    <textarea class="form-control" id="reasonTextarea" rows="1" style="resize: none; margin-bottom: 15px;" disabled><%= tCard.action %></textarea>
                                </div>
                               <% } %>
                              <% } %>
                              <span>
                                <label for="exampleTextarea">Last Updated <%= moment(tCard.containedAt).format("DD/MM/YYYY - HH:mm:ss") %></label>
                              </span>
                              


                              <a class="btn btn-danger float-right" style="margin-left: 8px;" href="/tCard/show/<%= tCard.division %>/<%= tCard.area %>/<%= tCard.location %>/<%= tCard.shiftP %>">Cancel</a>
                              <a class="btn btn-success float-right" style="margin-left: 8px;"href="/tCard/edit/<%= tCard._id %>">Re Check</a>
                            <!-- <button type="submit" class="btn btn-success float-right" style="margin-left: 8px; ">Submit</button> -->
                          </fieldset>
                        </form>
                  </div>
                  <div  style="background-color: rgb(252, 176, 38); display: flex; align-items: center; height: 50px; display: flex; ">
                      <img style="margin: 5px;" height="24px" src="/7z/content/images/jcb-logo.png"> <img height="24px" src="/7z/content/images/df.png">
                  </div>
                </div>
              </div>
    </div>
</div>

<!-- <ul>
  <% tCard.checks.sort((a,b) => b.createdAt - a.createdAt) %>
  <% tCard.checks.forEach(function(check){ %>
    <li>
      Checked By <%= check.checkedBy %> - <%= moment(check.createdAt).format("DD/MM/YYYY - HH:mm") %> Result - <%= check.result %>
    </li>

    <% }) %>
 </ul> -->












