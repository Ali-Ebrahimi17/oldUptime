<% layout('layouts/heatmap')%>
<!-- <meta http-equiv="refresh" content="900"> -->

<link rel="stylesheet" href="/content/bootstrap/css/bootstrap.css" type="text/css">
<link rel="stylesheet" href="/8z/content/dashboards.css" type="text/css">
<!-- <link rel="stylesheet" href="/7z/content/bootswatch/united.css" type="text/css"> -->
<link rel="stylesheet" href="/8z/content/font-awesome/css/all.css" type="text/css">
<link rel="stylesheet" href="/8z/content/chart-js/chart.min.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/style2.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/cards2.css" type="text/css">
<link rel="stylesheet" href="/content/table2.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/ldlHeatmap.css" type="text/css">
<script src="/8z/content/jquery/jquery-3.3.1.min.js"></script>





<style>
  body {
    background-color: black;
    overflow: hidden;
  }

  h5 {
    color: white;
    font-size: 1rem;
  }

  h3 {
    color: white;
    font-size: 2rem;
  }

  h2 {
    color: white;
    font-size: 18px;
  }

  h1 {
    font-size: 4rem;
  }

  h6 {
    font-size: 1rem;
  }

  hr {
    background-color: #6a6d6d;
  }

  .zone-stat {
    font-size: 60px;
    margin-top: -10px;
  }

  .zone-span {
    font-size: 60px;
    padding-top: 6px;
  }

  a {
    text-decoration: none;

  }

  a:hover {
    color: white;

  }

  small {
    font-weight: bold;
  }


  .main-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    flex-direction: column;
  }

  .date-holder {
    color: white;
    margin-top: -30px;
    padding-left: 20px;
  }

  .top-row {
    display: flex;
  }

  .bottom-row {
    display: flex;
    padding-left: 482px;
  }

  .found {
    color: white;
    font-size: 15px;
    padding-top: 6px;
  }

  .found-bottom {
    color: white;
    font-size: 15px;
    padding-top: 40px;
  }

  .sent-forward {
    color: white;
    font-size: 15px;
    /* padding-top: 35px; */
  }

  .fixed {
    color: white;
    font-size: 15px;
    /* padding-top: 35px; */
  }

  .escaped {
    color: white;
    font-size: 15px;
    /* padding-top: 35px; */
  }

  .pof-dpu-title {
    color: white;
    font-size: 20px;
    margin-top: -10px;
    /* padding-top: 35px; */
  }

  .shortage-dpu-title {
    color: white;
    font-size: 20px;
    /* padding-top: 35px; */
    margin-bottom: -8px;
  }

  .total-dpu-title {
    color: white;
    font-size: 20px;
    margin-top: -8px;
  }

  .forward {
    color: red;
    font-size: 20px;
    padding-top: 90px;
    width: 50px;
    text-align: center;
    display: flex;
    flex-direction: column;
  }

  .area-name {
    color: white;
    text-align: center;
    font-size: 20px;
  }

  .found-dpu {
    color: white;
    text-align: center;
    font-size: 17px;
    padding-top: 2px;
    display: flex;
    justify-content: space-evenly;
  }

  .forward-dpu {
    color: white;
    text-align: center;
    font-size: 15px;
  }

  .fixed-faults {
    color: white;
    text-align: center;
    font-size: 17px;
    margin-top: -3px;
    display: flex;
    justify-content: space-evenly;
  }

  .not-fixed-faults {
    color: red;
    text-align: center;
    font-size: 18px;
    display: flex;
    justify-content: space-evenly;

  }

  .not-fixed-faults-red {
    color: red;
    text-align: center;
    font-size: 18px;
    display: flex;
    justify-content: space-evenly;

  }

  .not-fixed-faults-green {
    color: green;
    text-align: center;
    font-size: 18px;
    display: flex;
    justify-content: space-evenly;

  }

  .pof-dpu-stat {
    color: white;
    text-align: center;
    font-size: 20px;
    margin-top: -10px;
    display: flex;
    justify-content: space-evenly;
  }

  .shortage-dpu-stat {
    color: white;
    text-align: center;
    font-size: 20px;
    margin-bottom: -8px;
    display: flex;
    justify-content: space-evenly;
  }

  .total-dpu-stat {
    color: white;
    text-align: center;
    font-size: 22px;
    display: flex;
    justify-content: center;
  }

  .area-holder {
    background-color: rgb(36, 42, 49);
    border-radius: 4px;
    width: 100px;
    height: 288px;
  }

  .graph-holder3 {
    background-color: rgb(36, 42, 49);
    width: 300px;
    height: 288px;
    margin-top: 35px;
    border-radius: 4px;
    margin-right: 65px;

  }

  .modal-fullscreen .modal-dialog {
    max-width: 100%;
    margin: 0;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100vh;
    display: flex;
    position: fixed;
    z-index: 100000;
  }



  thead,
  tbody,
  tr,
  td,
  th {
    display: block;
  }

  tr:after {
    content: ' ';
    display: block;
    visibility: hidden;
    clear: both;
  }

  thead th {
    height: 50px;

    /*text-align: left;*/
  }

  tbody {
    height: 650px;
    overflow-y: auto;
  }

  tbody td,
  thead th {
    width: 19.2%;
    float: left;
  }

  .modal-dialog-1 {
    max-width: 100%;
    margin: 0;
    top: 0;
    bottom: 0;
    left: 0;
    right: 0;
    height: 100vh;
    display: flex;
  }
</style>

<div class='main-header-holder'>
  <h1>Loadall Heat Map NFF to Hot Test</h1>
  <small>(<%= moment(startTime).format("DD/MM/YYYY  HH:mm") %> - <%= moment(endTime).format("DD/MM/YYYY  HH:mm") %>) <br>build - T1 (<%= lay %>) T3 (<%= track3lay %>)</small>
</div>

<section style="display: flex; flex-direction: column;">

  <div style="display: flex; justify-content: space-evenly; margin-top: 25px;">
    <div>
      <a href="/dash/sip/all/LDL"><i class="fas fa-user-cog"></i></a>
      <!-- <hr style="position:absolute; width: 1792px; margin-top: 50px; border-top: 1px dashed grey; background-color: transparent;"> -->
      <div class="found">
        Found
      </div>
      <div class="fixed">
        Fixed
      </div>
      <div class="sent-forward">
        Sent Forward
      </div>
      <div class="escaped">
        Escaped
      </div>
      <div class="escaped">
        Rectifiers
      </div>
      <hr>
      <div class="pof-dpu-title">
        Assy
      </div>
      <div class="shortage-dpu-title">
        Shortage
      </div>
      <hr>
      <div class="total-dpu-title">
        DPU
      </div>
    </div>
    <% for (let a of theArrayOfDataT1) { %>
    <!-- modals -->
    <!-- found faults -->
    <div class="modal fade" id="found<%= a.id  %>" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl modal-dialog-1">
        <div class="modal-content">
          <div style="background-color: rgb(252, 176, 38); height: 50px; color: black;">

            <h3 style="text-align: center; margin: 8px; color: black;"><%= a.foundInAreaNumber %> Faults found in <%= a.areaName %> (No Shortages)</h3>
          </div>
          <div class="modal-body" style="background-color: rgb(252, 176, 38);">

            <table class="table table-hover table-dark" style="font-size: 15px; max-height : 300px;">
              <thead>
                <tr class="d-flex">
                  <th style="width: 50px;">#</th>
                  <th style="width: 200px;">Date/Time</th>
                  <th style="width: 130px;">Build Number</th>
                  <th style="width: 150px;">Model</th>
                  <th style="width: 150px;">Failed At</th>
                  <th style="width: 170px;">Failed By</th>
                  <th style="width: 170px;">Fixed By</th>
                  <th style="width: 170px;">Fault Area</th>
                  <th style="width: 170px;">Fault Type</th>
                  <th style="width: 250px;">Fault Detail</th>
                  <th style="width: 250px;">Comments</th>
                </tr>
              </thead>
              <tbody>
                <% let foundx = 0 %>
                <% for (let j of a.foundInAreaFaults) { %>
                <% foundx++ %>
                <tr class="d-flex">
                  <td style="width: 50px;"><%= foundx %></td>
                  <td style="width: 200px;"><%= moment(j['Created Date']).format("DD/MM/YYYY - HH:mm")%></td>
                  <td style="height: 55px; width: 130px;"><%= j['Build Number'] %></td>
                  <td style="width: 150px;"><%= j.Model %></td>
                  <td style="width: 150px;"><%= j.Zone %></td>
                  <td style="width: 170px;"><%= j['Created By'] %></td>
                  <td style="width: 170px;"><%= j['Fixed By'] %></td>
                  <td style="width: 170px;"><%= j['Fault Area'] %></td>
                  <td style="width: 170px;"><%= j['Fault Code'] %></td>
                  <td style="width: 250px;"><%= j['User Defined Test'] %></td>
                  <td style="width: 250px;"><%= j.Comments %></td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <!-- <div class="modal-footer" style="border: none; background-color: rgb(252, 176, 38); border-radius: 0; ">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div> -->
          <div style="background-color: rgb(252, 176, 38); display: flex; align-items: center; height: 50px; display: flex; justify-content: space-between; ">
            <div><img style="margin: 5px;" height="24px" src="/7z/content/images/jcb-logo.png"> <img height="24px" src="/7z/content/images/df.png"></div>
            <div style="margin-right: 20px; margin-bottom: 11px;"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button></div>


          </div>
        </div>
      </div>
    </div>

    <!-- fixed faults -->
    <div class="modal fade" id="fixed<%= a.id  %>" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl modal-dialog-1">
        <div class="modal-content">
          <div style="background-color: rgb(252, 176, 38); height: 50px; color: black;">

            <h3 style="text-align: center; margin: 8px; color: black;"><%= a.fixedInAreaNumber %> fixed in <%= a.areaName %> (No Shortages)</h3>
          </div>
          <div class="modal-body" style="background-color: rgb(252, 176, 38);">

            <table class="table table-hover table-dark" style="font-size: 15px; max-height : 300px;">
              <thead>
                <tr class="d-flex">
                  <th style="width: 50px;">#</th>
                  <th style="width: 200px;">Date/Time</th>
                  <th style="width: 130px;">Build Number</th>
                  <th style="width: 150px;">Model</th>
                  <th style="width: 150px;">Failed At</th>
                  <th style="width: 170px;">Failed By</th>
                  <th style="width: 170px;">Fixed By</th>
                  <th style="width: 170px;">Fault Area</th>
                  <th style="width: 170px;">Fault Type</th>
                  <th style="width: 250px;">Fault Detail</th>
                  <th style="width: 250px;">Comments</th>
                </tr>
              </thead>
              <tbody>
                <% let fixedx = 0 %>
                <% for (let j of a.fixedInAreaFaults) { %>
                <% fixedx++ %>
                <tr class="d-flex">
                  <td style="width: 50px;"><%= fixedx %></td>
                  <td style="width: 200px;"><%= moment(j['Created Date']).format("DD/MM/YYYY - HH:mm")%></td>
                  <td style="height: 55px; width: 130px;"><%= j['Build Number'] %></td>
                  <td style="width: 150px;"><%= j.Model %></td>
                  <td style="width: 150px;"><%= j.Zone %></td>
                  <td style="width: 170px;"><%= j['Created By'] %></td>
                  <td style="width: 170px;"><%= j['Fixed By'] %></td>
                  <td style="width: 170px;"><%= j['Fault Area'] %></td>
                  <td style="width: 170px;"><%= j['Fault Code'] %></td>
                  <td style="width: 250px;"><%= j['User Defined Test'] %></td>
                  <td style="width: 250px;"><%= j.Comments %></td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <!-- <div class="modal-footer" style="border: none; background-color: rgb(252, 176, 38); border-radius: 0; ">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div> -->
          <div style="background-color: rgb(252, 176, 38); display: flex; align-items: center; height: 50px; display: flex; justify-content: space-between; ">
            <div><img style="margin: 5px;" height="24px" src="/7z/content/images/jcb-logo.png"> <img height="24px" src="/7z/content/images/df.png"></div>
            <div style="margin-right: 20px; margin-bottom: 11px;"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button></div>


          </div>
        </div>
      </div>
    </div>

    <!-- not fixed faults -->
    <div class="modal fade" id="notFixed<%= a.id  %>" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable modal-xl modal-dialog-1">
        <div class="modal-content">
          <div style="background-color: rgb(252, 176, 38); height: 50px; color: black;">

            <h3 style="text-align: center; margin: 8px; color: black;"><%= a.notFixedInAreaNumber %> Sent forward from <%= a.areaName %> (No Shortages)</h3>
          </div>
          <div class="modal-body" style="background-color: rgb(252, 176, 38);">

            <table class="table table-hover table-dark" style="font-size: 15px; max-height : 300px;">
              <thead>
                <tr class="d-flex">
                  <th style="width: 50px;">#</th>
                  <th style="width: 200px;">Date/Time</th>
                  <th style="width: 130px;">Build Number</th>
                  <th style="width: 150px;">Model</th>
                  <th style="width: 150px;">Failed At</th>
                  <th style="width: 170px;">Failed By</th>
                  <th style="width: 170px;">Fixed By</th>
                  <th style="width: 170px;">Fault Area</th>
                  <th style="width: 170px;">Fault Type</th>
                  <th style="width: 250px;">Fault Detail</th>
                  <th style="width: 250px;">Comments</th>
                </tr>
              </thead>
              <tbody>
                <% let notFixedx = 0 %>
                <% for (let j of a.notFixedInAreaFaults) { %>
                <% notFixedx++ %>
                <tr class="d-flex">
                  <td style="width: 50px;"><%= notFixedx %></td>
                  <td style="width: 200px;"><%= moment(j['Created Date']).format("DD/MM/YYYY - HH:mm")%></td>
                  <td style="height: 55px; width: 130px;"><%= j['Build Number'] %></td>
                  <td style="width: 150px;"><%= j.Model %></td>
                  <td style="width: 150px;"><%= j.Zone %></td>
                  <td style="width: 170px;"><%= j['Created By'] %></td>
                  <td style="width: 170px;"><%= j['Fixed By'] %></td>
                  <td style="width: 170px;"><%= j['Fault Area'] %></td>
                  <td style="width: 170px;"><%= j['Fault Code'] %></td>
                  <td style="width: 250px;"><%= j['User Defined Test'] %></td>
                  <td style="width: 250px;"><%= j.Comments %></td>
                </tr>
                <% } %>
              </tbody>
            </table>
          </div>
          <!-- <div class="modal-footer" style="border: none; background-color: rgb(252, 176, 38); border-radius: 0; ">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div> -->
          <div style="background-color: rgb(252, 176, 38); display: flex; align-items: center; height: 50px; display: flex; justify-content: space-between; ">
            <div><img style="margin: 5px;" height="24px" src="/7z/content/images/jcb-logo.png"> <img height="24px" src="/7z/content/images/df.png"></div>
            <div style="margin-right: 20px; margin-bottom: 11px;"><button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button></div>


          </div>
        </div>
      </div>
    </div>
    <div class="area-holder">
      <div class="area-name">
        <%= a.areaName %>
      </div>
      <div class="found-dpu" data-toggle="modal" data-target="#found<%= a.id  %>" style="cursor: pointer;">
        <div>(<%= a.foundInAreaNumber %>)</div>
        <div><%= a.foundInAreaDPU %></div>
      </div>
      <div class="fixed-faults" data-toggle="modal" data-target="#fixed<%= a.id  %>" style="cursor: pointer;">
        <div>(<%= a.fixedInAreaNumber %>)</div>
        <div><%= a.fixedInAreaDPU %></div>
      </div>
      <div class="<% if (Math.round(a.notFixedInAreaDPU / a.fixedInAreaDPU * 100 ) >= 30) { %>not-fixed-faults-red<% } else { %>not-fixed-faults-green<% } %>" data-toggle="modal" data-target="#notFixed<%= a.id  %>" style="cursor: pointer;">
        <div>(<%= a.notFixedInAreaNumber %>)</div>
        <div><%=  a.notFixedInAreaDPU %></div>
      </div>
      <div class="fixed-faults">
        <div>(<%= a.escapedAreaNumber%>)</div>
        <div><%=  a.escapedAreaDPU %></div>
      </div>
      <div class="fixed-faults" style="padding-bottom: 1px;">
        <%= a.recNumber %>
      </div>
      <hr>
      <div class="pof-dpu-stat">
        <div>(<%= a.foundInAreaNumber %>)</div>
        <div><%= a.foundInAreaDPU %></div>
      </div>
      <div class="shortage-dpu-stat">
        <div>(<%= a.foundInAreaNumberSh %>)</div>
        <div><%= a.foundInAreaDPUSh %></div>
      </div>
      <hr>
      <div class="total-dpu-stat" style="margin-top: -12px;">
        <%= a.areaDPU.toFixed(2) %>
      </div>
    </div>

    <div class="forward">
      <%= a.notFixedInAreaDPU %>
      <span style="font-size: 20px;" class="<% if (a.forwardPercentage  >= 30) { %>not-fixed-faults-red<% } else { %>not-fixed-faults-green<% } %>">
        <%= a.forwardPercentage %>%
      </span>
      <% if (a.areaName === 'Zone 7') { %>
      <i class="fas fa-level-down-alt"></i>
      <% } else { %>
      <i class="fas fa-arrow-right"></i>
      <% } %>


      <div class="total-dpu-stat" style="padding-top: 44px;">
        <%= a.totalDPU.toFixed(2) %>
      </div>
    </div>


    <% } %>



  </div>


  <div style="display: flex; justify-content: space-between;">
    <div style="display: flex; justify-content: space-evenly; margin-top: 35px; width: 440px; margin-left: 820px;">
      <div>

        <!-- <hr style="position:absolute; width: 1792px; margin-top: 50px; border-top: 1px dashed grey; background-color: transparent;"> -->
        <div class="found-bottom">
          Found
        </div>
        <div class="fixed">
          Fixed
        </div>
        <div class="sent-forward">
          Sent Forward
        </div>
        <div class="escaped">
          Escaped
        </div>
        <div class="escaped">
          Rectifiers
        </div>
        <hr>
        <div class="pof-dpu-title">
          Assy
        </div>
        <div class="shortage-dpu-title">
          Shortage
        </div>
        <hr>
        <div class="total-dpu-title">
          DPU
        </div>
      </div>
      <% for (let a of theArrayOfDataT3) { %>
      <div class="area-holder">
        <div class="area-name">
          <%= a.areaName %>
        </div>
        <a data-toggle="modal" data-target="#bhlOpen" style="cursor: pointer;">
        </a>
        <div class="found-dpu">
          <div>(<%= a.foundInAreaNumber %>)</div>
          <div><%= a.foundInAreaDPU %></div>
        </div>
        <div class="fixed-faults">
          <div>(<%= a.fixedInAreaNumber %>)</div>
          <div><%= a.fixedInAreaDPU %></div>
        </div>
        <div class="<% if (Math.round(a.notFixedInAreaDPU / a.fixedInAreaDPU * 100 ) >= 30) { %>not-fixed-faults-red<% } else { %>not-fixed-faults-green<% } %>">
          <div>(<%= a.notFixedInAreaNumber %>)</div>
          <div><%=  a.notFixedInAreaDPU %></div>
        </div>
        <div class="fixed-faults">
          <div>(<%= a.escapedAreaNumber%>)</div>
          <div><%=  a.escapedAreaDPU %></div>
        </div>
        <div class="fixed-faults" style="padding-bottom: 1px;">
          <%= a.recNumber %>
        </div>
        <hr>
        <div class="pof-dpu-stat">
          <div>(<%= a.foundInAreaNumber %>)</div>
          <div><%= a.foundInAreaDPU %></div>
        </div>
        <div class="shortage-dpu-stat">
          <div>(<%= a.foundInAreaNumberSh %>)</div>
          <div><%= a.foundInAreaDPUSh %></div>
        </div>
        <hr>
        <div class="total-dpu-stat" style="margin-top: -12px;">
          <%= a.areaDPU.toFixed(2) %>
        </div>
      </div>

      <div class="forward">
        <%= a.fixedInAreaDPU %>
        <span style="font-size: 20px;" class="<% if (a.forwardPercentage  >= 30) { %>not-fixed-faults-red<% } else { %>not-fixed-faults-green<% } %>">
          <%= a.forwardPercentage %>%
        </span>
        <% if (a.areaName === 'T3 SIP 2') { %>
        <i class="fas fa-level-up-alt"></i>
        <% } else { %>
        <i class="fas fa-arrow-right"></i>
        <% } %>


        <div class="total-dpu-stat" style="padding-top: 44px;">
          <%= a.totalDPU3.toFixed(2) %>
        </div>
      </div>


      <% } %>

    </div>


    <div class="graph-holder3">

      <div class="area-name">
        Zone 7 Rectification
      </div>
      <div style="text-align: center; color: white; margin-top: 5px;">
        Booked on to Stage 16
      </div>
      <div class="found-dpu" style="font-size: 28px; margin-top: -5px;">
        <%= stage16.length %>
      </div>

      <div style="display: flex; justify-content: space-evenly; margin-top: 10px;">
        <div>
          <div style="text-align: center; color: white; margin-top: -5px;">
            Faults Forward
          </div>
          <div class="found-dpu" style="font-size: 28px;">
            <%= faultsOutOfOBay.length %>
          </div>
          <div class="found-dpu" style="font-size: 28px;">
            <span style="font-size: 10px;">DPU</span>
          </div>
          <div class="found-dpu" style="font-size: 28px; margin-top: -10px;">
            <%= faultsDPUforward %>
          </div>

        </div>

        <div>
          <div style="text-align: center; color: white; margin-top: -5px;">
            Shortages Forward
          </div>
          <div class="found-dpu" style="font-size: 28px;">
            <%= shortageOutOfOBay.length %>
          </div>
          <div class="found-dpu" style="font-size: 28px;">
            <span style="font-size: 10px;">DPU</span>
          </div>
          <div class="found-dpu" style="font-size: 28px; margin-top: -10px;">
            <%= shortageDPUforward %>
          </div>

        </div>

      </div>

      <div style="text-align: center; color: white; margin-top: 10px; ">
        Total DPU to test
        <div class="found-dpu" style="font-size: 28px; margin-top: -8px; ">
          <%= totalDPUForward %>
        </div>


      </div>


    </div>




</section>





<div class="container-fluid footer">

  <div class="row header-top">
    <div class="col-lg-6 d-none d-lg-block text-left" style="padding: 4px 4px 5px 4px">
      <img height="24px" src="/7z/content/images/jcb-logo.png">
      <img height="24px" src="/7z/content/images/df.png">
    </div>
    <div class="col-lg-6 d-lg-block text-right" style="padding: 6px 12px 5px 0px; font-weight: bold">
      J.C. Bamford Excavators LTD &copy; 2022
    </div>
  </div>
</div>