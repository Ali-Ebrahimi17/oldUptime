<% layout('layouts/heatmap')%>
<!-- <meta http-equiv="refresh" content="100"> -->
<link rel="stylesheet" href="/8z/content/bootstrap/css/bootstrap.css" type="text/css">
<link rel="stylesheet" href="/8z/content/dashboards.css" type="text/css">
<link rel="stylesheet" href="/8z/content/bootswatch/united.css" type="text/css">
<link rel="stylesheet" href="/8z/content/font-awesome/css/all.css" type="text/css">
<link rel="stylesheet" href="/8z/content/chart-js/chart.min.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/style2.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/cards2.css" type="text/css">
<link rel="stylesheet" href="/content/table2.css" type="text/css">
<link rel="stylesheet" href="/stylesheets/ldlHeatmap.css" type="text/css">
<script src="/8z/content/jquery/jquery-3.3.1.min.js"></script>


<script src="/7z/content/chart-js/chart.bundle.min.js"></script>
<!-- <script src="/7z/content/chart-js/chartjs-plugin-labels.min.js"></script> -->
<script src="/7z/content/chart-js/chartjs-plugin-datalabels.min.js"></script>


<style>
  body {
    background-color: black;
  }

  h5 {
    color: white;
    font-size: 1rem;
  }

  h3 {
    color: white;
    font-size: 2rem;
  }

  h2 {
    color: white;
    font-size: 18px;
  }

  h1 {
    font-size: 4rem;
  }

  h6 {
    font-size: 1rem;
  }

  hr {
    background-color: #6a6d6d;
  }

  .zone-stat {
    font-size: 60px;
    margin-top: -10px;
  }

  .zone-span {
    font-size: 60px;
    padding-top: 6px;
  }

  a {
    text-decoration: none;

  }

  a:hover {
    color: white;

  }

  .graph-holder1 {
    background-color: rgb(36, 42, 49);
    width: 323px;
    height: 160px;
    margin: 0px 10px 10px 10px;
    /* border: 1px solid white; */
    padding-top: 8px;
    border-radius: 4px;
  }

  .graph-holder2 {
    background-color: rgb(36, 42, 49);
    width: 1700px;
    height: 250px;
    margin-bottom: 50px;
    /* border: 1px solid white; */
    padding-right: 8px;
    border-radius: 4px;
  }

  .main-wrapper {
    display: flex;
    align-items: center;
    justify-content: space-evenly;
    flex-direction: column;
  }

  .top-row {
    display: flex;
  }

  .middle-row {
    display: flex;
  }

  .over-3 {
    color: white;
    text-align: center;
    font-size: 65px;
  }

  .eff-data {
    color: white;
    text-align: center;
    font-size: 12px;
  }

  .eff-stat {
    color: white;
    text-align: center;
    font-size: 65px;
  }
</style>

<div class='main-header-holder'>
  <div style="position: absolute; right: 0; margin-right: 115px;"><a href="/dash/dpu/LDL/<%= area %>" type="button" class="btn btn-primary" style="color: white; border-radius: 4;">Switch to Rolling 6 Weeks</a></div>
  <h1>Loadall <%= area %></h1>
  <small>Rolling 7 days (Excluding Shortages)</small>
</div>

<div class="main-wrapper" style="margin-top: 10px;">
  <div class="top-row">
    <% if (issues.length > 0) { %>
    <a href="/dash/dpuFaultDataD/Loadall/<%= area %>/0">
      <div class="graph-holder1">
        <h5><%= issues[0]._id.substring(0, 30) %> - <%= issues[0].count %></h5>
        <div style="margin-bottom: -50px;">
          <canvas id="canvas1" height="11" width="28"></canvas>
        </div>
      </div>
    </a>
    <% } %>
    <% if (issues.length > 1) { %>
    <a href="/dash/dpuFaultDataD/Loadall/<%= area %>/1">
      <div class="graph-holder1">
        <h5><%= issues[1]._id.substring(0, 30) %> - <%= issues[1].count %></h5>
        <div style="margin-bottom: -50px;">
          <canvas id="canvas2" height="11" width="28"></canvas>
        </div>
      </div>
      <a />
      <% } %>
      <% if (issues.length > 2) { %>
      <a href="/dash/dpuFaultDataD/Loadall/<%= area %>/2">
        <div class="graph-holder1">
          <h5><%= issues[2]._id.substring(0, 30) %> - <%= issues[2].count %></h5>
          <div style="margin-bottom: -50px;">
            <canvas id="canvas3" height="11" width="28"></canvas>
          </div>
        </div>
      </a>
      <% } %>
      <% if (issues.length > 3) { %>
      <a href="/dash/dpuFaultDataD/Loadall/<%= area %>/3">
        <div class="graph-holder1">
          <h5><%= issues[3]._id.substring(0, 30) %> - <%= issues[3].count %></h5>
          <div style="margin-bottom: -50px;">
            <canvas id="canvas4" height="11" width="28"></canvas>
          </div>
        </div>
      </a>
      <% } %>
      <% if (issues.length > 4) { %>
      <a href="/dash/dpuFaultDataD/Loadall/<%= area %>/4">
        <div class="graph-holder1">
          <h5><%= issues[4]._id.substring(0, 30) %> - <%= issues[4].count %></h5>
          <div style="margin-bottom: -50px;">
            <canvas id="canvas5" height="11" width="28"></canvas>
          </div>
        </div>
      </a>
      <% } %>
  </div>
  <div class="top-row">
    <div class="graph-holder1">
      <a href="/dash/over3D/<%= area %>">
        <h2>Escalations</h2>
        <div style="display: flex; justify-content: space-evenly; margin-top: 15px;">
          <div>
            <h2 style="margin-bottom: -2px;">Over 2</h2>
            <div class="over-3" style="font-size: 36px;">
              <%= issuesOver2.length  %>
            </div>
          </div>
          <div>
            <h2 style="margin-bottom: -2px;">Over 4</h2>
            <div class="over-3" style="font-size: 36px;">
              <%= issuesOver4.length  %>
            </div>
          </div>
          <div>
            <h2 style="margin-bottom: -2px;">Over 6</h2>
            <div class="over-3" style="font-size: 36px;">
              <%= issuesOver6.length  %>
            </div>
          </div>
        </div>

      </a>
    </div>
    <div class="graph-holder1">
      <a href="/dash/notFixedD/<%= area %>/LDL">
        <h2>Not Fixed In Area</h2>
        <div class="over-3">
          <%= allFaultsNotFixedInArea.length  %>
        </div>
        <div class="eff-data" style="margin-top: -15px;">
          <%= allFaultsForNotFixed.length  %> Total Faults
        </div>
        <div class="eff-data">
          <%= notFixedPercentage %>% Sent Forward
        </div>
      </a>
    </div>
    <div class="graph-holder1">
      <h2>Faults Fixed In Area</h2>
      <div class="over-3">
        <%= allFaultsForNotFixed.length - allFaultsNotFixedInArea.length %>
      </div>
      <div class="eff-data" style="margin-top: -15px;">
        <%= 100 - notFixedPercentage %>%
      </div>
    </div>
    <div class="graph-holder1">
      <a href="/dash/notRFTD/<%= area %>/LDL">
        <h2>RFT %</h2>
        <div class="eff-stat">
          <!-- <%= rftPercent  %>% -->
          --%
        </div>
        <div class="eff-data" style="margin-top: -15px;">
          -- Total Build
        </div>
        <div class="eff-data">
          -- RFT
        </div>
      </a>
    </div>
    <div class="graph-holder1">
      <% if (theSipStation === 'N/A' ) { %>
      <h2>Efficiency N/A</h2>

      <% } else { %>
      <a href="/dash/escapesD/loadall/<%= area %>">
        <h2><%= theSipStation %> Efficiency</h2>
        <div class="eff-stat">
          --%
        </div>
        <div class="eff-data" style="margin-top: -15px;">
          -- Total Faults
        </div>
        <div class="eff-data">
          --  %> Found - -- Escaped
        </div>
      </a>
      <% } %>

    </div>
  </div>


  <div class="graph-holder2">
    <canvas id="line-chart" style="padding-top: 10px; padding-bottom: 55px;" height="60" width="330"></canvas>
    <!-- <canvas style="padding-top: 10px; " id="canvas1" height="100" width="330" ></canvas> -->
  </div>




</div>





<div class="container-fluid footer">

  <div class="row header-top">
    <div class="col-lg-6 d-none d-lg-block text-left" style="padding: 4px 4px 5px 4px">
      <img height="24px" src="/7z/content/images/jcb-logo.png">
      <img height="24px" src="/7z/content/images/df.png">
    </div>
    <div class="col-lg-6 d-lg-block text-right" style="padding: 6px 12px 5px 0px; font-weight: bold">
      J.C. Bamford Excavators LTD &copy; 2022
    </div>
  </div>
</div>


<script>
  Chart.defaults.global.defaultFontColor = '#fff';
  Chart.defaults.scale.gridLines.display = false;



  <% let labels = [] %>
  <% let dpu = [] %>
  <% let target = [] %>
  <% let colors = 'rgb(255, 123, 0)' %>



  <% for (let l of allFaultsWithoutShortages) { %>
  <% labels.push(`${l._id.day}/${l._id.month}`) %>
  <% dpu.push(+l.dpu)  %>
  <% target.push(l.target) %>

  <% } %>


  new Chart(document.getElementById("line-chart"), {
    type: 'line',
    data: {
      labels: <%- JSON.stringify(labels) %>,
      datasets: [{
        data: <%- JSON.stringify(dpu) %>,
        label: "DPU",
        borderColor: "#3e95cd",
        fill: false
      }, {
        data: <%- JSON.stringify(target) %>,
        label: "Target",
        borderColor: "red",
        fill: false
      }, ]
    },
    options: {
      title: {
        display: true,
        text: 'DPU By Day'
      },
      legend: {
        display: false,
      },
      scales: {
        xAxes: [{

          gridLines: {
            display: false
          }
        }],
        yAxes: [{
          ticks: {
            beginAtZero: true,
            min: 0,
            // max         : 20,
            display: true,
          },
          gridLines: {
            display: false
          },
        }, {

          ticks: {
            beginAtZero: true,
            min: 0,
            max: 100,
            display: false,
          },
          gridLines: {
            display: false
          }
        }]
      }
    }
  });



  <% let labelsBHL1 = [] %>
  <% let effBHL1 = [] %>

  <% let labelsBHL2 = [] %>
  <% let effBHL2 = [] %>

  <% let labelsBHL3 = [] %>
  <% let effBHL3 = [] %>

  <% let labelsBHL4 = [] %>
  <% let effBHL4 = [] %>

  <% let labelsBHL5 = [] %>
  <% let effBHL5 = [] %>


  <% if (issues.length > 0) { %>
  <% for (i of issues[0].graph) { %>
  <%  labelsBHL1.push(i._id.day +'/'+ i._id.month ) %>
  <% } %>
  <% for (i of issues[0].graph) { %>
  <%  effBHL1.push(i.count ) %>
  <% } %>
  <% } %>



  <% if (issues.length > 1) { %>
  <% for (i of issues[1].graph) { %>
  <%  labelsBHL2.push(i._id.day +'/'+ i._id.month ) %>
  <% } %>
  <% for (i of issues[1].graph) { %>
  <%  effBHL2.push(i.count ) %>
  <% } %>
  <% } %>


  <% if (issues.length > 2) { %>
  <% for (i of issues[2].graph) { %>
  <%  labelsBHL3.push(i._id.day +'/'+ i._id.month ) %>
  <% } %>
  <% for (i of issues[2].graph) { %>
  <%  effBHL3.push(i.count ) %>
  <% } %>
  <% } %>

  <% if (issues.length > 3) { %>
  <% for (i of issues[3].graph) { %>
  <%  labelsBHL4.push(i._id.day +'/'+ i._id.month ) %>
  <% } %>
  <% for (i of issues[3].graph) { %>
  <%  effBHL4.push(i.count ) %>
  <% } %>
  <% } %>

  <% if (issues.length > 4) { %>
  <% for (i of issues[4].graph) { %>
  <%  labelsBHL5.push(i._id.day +'/'+ i._id.month ) %>
  <% } %>
  <% for (i of issues[4].graph) { %>
  <%  effBHL5.push(i.count ) %>
  <% } %>
  <% } %>

  let options = {
    title: {
      display: false,
      text: 'Faults Volume By Area',
    },
    legend: {
      display: false,
    },
    tooltips: {
      mode: 'label',
      enabled: false,
      callbacks: {
        label: function(tooltipItems, data) {
          // if (data.datasets[tooltipItems.datasetIndex].label != "Running Time")  {
          return data.datasets[tooltipItems.datasetIndex].label;
        }
        // },
      }
    },
    responsive: true,
    scales: {
      xAxes: [{
        stacked: true,
        barPercentage: 0.8,
      }, ],
      yAxes: [{
          stacked: false,
          display: false,
          ticks: {
            beginAtZero: true,

          },
          scaleLabel: {
            display: false,
            labelString: 'Hours',
          },
        },
        {
          id: 'bar-y-axis',
          stacked: true,
          display: false,
          ticks: {
            beginAtZero: true,

          },
          type: 'linear',
        },
      ],
    },

  }




  let barChartData1 = {

    labels: <%- JSON.stringify(labelsBHL1); %>,
    newLabels: <%- JSON.stringify(effBHL1); %>,
    datasets: [

      {
        label: 'Count',
        backgroundColor: <%- JSON.stringify(colors); %>,
        yAxisID: 'bar-y-axis',
        datalabels: {
          // display labels for this specific dataset
          display: true,
          color: 'white',
          align: 'middle',
          anchor: 'middle',
          formatter: function(value, context) {
            return context.chart.data.newLabels[context.dataIndex];
            // return value + '%';
          },
          font: {
            size: 12,
          },
        },
        data: <%- JSON.stringify(effBHL1); %>,
      },
    ],
  };

  // graph 2
  let barChartData2 = {

    labels: <%- JSON.stringify(labelsBHL2); %>,
    newLabels: <%- JSON.stringify(effBHL2); %>,
    datasets: [

      {
        label: 'Count',
        backgroundColor: <%- JSON.stringify(colors); %>,
        yAxisID: 'bar-y-axis',
        datalabels: {
          // display labels for this specific dataset
          display: true,
          color: 'white',
          align: 'middle',
          anchor: 'middle',
          formatter: function(value, context) {
            return context.chart.data.newLabels[context.dataIndex];
            // return value + '%';
          },
          font: {
            size: 12,
          },
        },
        data: <%- JSON.stringify(effBHL2); %>,
      },
    ],
  };

  // graph 3
  let barChartData3 = {

    labels: <%- JSON.stringify(labelsBHL3); %>,
    newLabels: <%- JSON.stringify(effBHL3); %>,
    datasets: [

      {
        label: 'Count',
        backgroundColor: <%- JSON.stringify(colors); %>,
        yAxisID: 'bar-y-axis',
        datalabels: {
          // display labels for this specific dataset
          display: true,
          color: 'white',
          align: 'middle',
          anchor: 'middle',
          formatter: function(value, context) {
            return context.chart.data.newLabels[context.dataIndex];
            // return value + '%';
          },
          font: {
            size: 12,
          },
        },
        data: <%- JSON.stringify(effBHL3); %>,
      },
    ],
  };

  // graph 4
  let barChartData4 = {

    labels: <%- JSON.stringify(labelsBHL4); %>,
    newLabels: <%- JSON.stringify(effBHL4); %>,
    datasets: [

      {
        label: 'Count',
        backgroundColor: <%- JSON.stringify(colors); %>,
        yAxisID: 'bar-y-axis',
        datalabels: {
          // display labels for this specific dataset
          display: true,
          color: 'white',
          align: 'middle',
          anchor: 'middle',
          formatter: function(value, context) {
            return context.chart.data.newLabels[context.dataIndex];
            // return value + '%';
          },
          font: {
            size: 12,
          },
        },
        data: <%- JSON.stringify(effBHL4); %>,
      },
    ],
  };

  // graph 5
  let barChartData5 = {

    labels: <%- JSON.stringify(labelsBHL5); %>,
    newLabels: <%- JSON.stringify(effBHL5); %>,
    datasets: [

      {
        label: 'Count',
        backgroundColor: <%- JSON.stringify(colors); %>,
        yAxisID: 'bar-y-axis',
        datalabels: {
          // display labels for this specific dataset
          display: true,
          color: 'white',
          align: 'middle',
          anchor: 'middle',
          formatter: function(value, context) {
            return context.chart.data.newLabels[context.dataIndex];
            // return value + '%';
          },
          font: {
            size: 12,
          },
        },
        data: <%- JSON.stringify(effBHL5); %>,
      },
    ],
  };



  window.onload = function() {

    var ctx = document.getElementById("canvas1");
    var myChart = new Chart(ctx, {
      type: 'bar',
      data: barChartData1,
      options: options
    });


    //graph 2

    var ctx2 = document.getElementById("canvas2");
    var myChart2 = new Chart(ctx2, {
      type: 'bar',
      data: barChartData2,
      options: options
    });


    //graph 3

    var ctx3 = document.getElementById("canvas3");
    var myChart3 = new Chart(ctx3, {
      type: 'bar',
      data: barChartData3,
      options: options
    });


    var ctx4 = document.getElementById("canvas4");
    var myChart4 = new Chart(ctx4, {
      type: 'bar',
      data: barChartData4,
      options: options
    });

    //graph 5

    var ctx5 = document.getElementById("canvas5");
    var myChart5 = new Chart(ctx5, {
      type: 'bar',
      data: barChartData5,
      options: options
    });

  }
</script>